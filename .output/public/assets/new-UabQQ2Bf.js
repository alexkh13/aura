import{c as H,_ as F,u as J,a as Y,r as l,j as e,k as Q}from"./main-DwSGQJQP.js";import{m as Z,g as ee,h as ae,u as te}from"./useData-CfHr73R5.js";import{C as re}from"./chevron-left-BaNQVTVO.js";import{T as se}from"./trash-2-DjgZj84f.js";import{S as j}from"./sparkles-CFiWLsoS.js";import{X as ne}from"./x-ev_B8KbH.js";import{I as le}from"./image-Dqgfnhk2.js";import{C as oe}from"./camera-Bp-8NLU3.js";import{U as ie}from"./upload-D90mfJVC.js";import{C as de}from"./check-B7ifIDri.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],U=H("loader-circle",ce);async function me(o,x){try{const{extractMultipleGarments:d}=await F(async()=>{const{extractMultipleGarments:m}=await import("./gemini-C8uUB5dP.js");return{extractMultipleGarments:m}},[]);return await d(o,(m,p)=>{x?.({stage:p<100?"analyzing":"complete",progress:p,message:m})})}catch(d){throw console.error("Garment extraction failed:",d),d}}async function ge(){return typeof window>"u"?!1:!!localStorage.getItem("google_ai_token")}async function ue(o,x,d){try{const{generateOutfitSuggestion:h}=await F(async()=>{const{generateOutfitSuggestion:p}=await import("./gemini-C8uUB5dP.js");return{generateOutfitSuggestion:p}},[]);return await h(o,x,d)}catch(h){return console.error("Outfit generation failed:",h),null}}function ke(){const o=J(),x=Z(),d=ee(),h=ae(),{activeProfile:m}=Y(),[p,A]=l.useState(null),[b,D]=l.useState(null),w=l.useRef(null),N=l.useRef(null),[k,z]=l.useState(!1),[T,$]=l.useState({message:"",progress:0}),[I,E]=l.useState(!1),[i,f]=l.useState([{name:"",category:"",color:"",size:"",brand:"",tags:"",notes:"",hasPhoto:!1,aiGenerated:!1}]),[c,S]=l.useState(0),[C,G]=l.useState(!1),[X,_]=l.useState(!1),[P,O]=l.useState(!1),{data:M}=te(m?.id);l.useState(()=>{ge().then(E)});const a=i[c],L=t=>{const s=t.target.files?.[0];if(!s)return;if(s.size>10*1024*1024){alert("Photo size must be less than 10MB");return}if(!s.type.startsWith("image/")){alert("Please select an image file");return}A(s);const r=new FileReader;r.onloadend=()=>{const n=r.result;D(n),f(u=>u.map(y=>({...y,hasPhoto:!0})))},r.readAsDataURL(s)},B=()=>{D(null),A(null),f(t=>t.map(s=>({...s,hasPhoto:!1}))),w.current&&(w.current.value=""),N.current&&(N.current.value="")},K=async()=>{if(p){if(!I){confirm("Google AI API key not configured. Go to Settings?")&&o({to:"/settings/ai"});return}z(!0);try{const t=await me(p,r=>{$({message:r.message,progress:r.progress})});if(t.length===0){alert("No garments detected in this image. Please try a different photo.");return}const s=t.map(r=>({name:r.name,category:r.category,color:r.color||"",size:"",brand:"",tags:r.tags||"",notes:r.notes||"",hasPhoto:!0,aiGenerated:!0,imageData:r.imageData,metadata:r.metadata}));console.log("✅ Created items with AI-generated images:",s.map(r=>({name:r.name,hasImageData:!!r.imageData,imageDataSize:r.imageData?.length}))),f(s),S(0)}catch(t){console.error("AI analysis failed:",t),alert(t instanceof Error?t.message:"AI analysis failed. Please try again.")}finally{z(!1)}}},g=t=>{f(s=>s.map((r,n)=>n===c?{...r,...t}:r))},R=async()=>{if(!a.name.trim()||!a.category.trim()){alert("Please fill in the required fields: Name and Category");return}if(!m){alert("No active profile selected");return}try{let t;if(a.saved&&a.id?(await d.mutateAsync({id:a.id,data:{name:a.name.trim(),category:a.category.trim(),hasPhoto:a.hasPhoto,photo:a.imageData||b||"",color:a.color.trim()||"",size:a.size.trim()||"",brand:a.brand.trim()||"",tags:a.tags.trim()||"",notes:a.notes.trim()||""}}),t=a.id):(t=(await x.mutateAsync({name:a.name.trim(),category:a.category.trim(),hasPhoto:a.hasPhoto,photo:a.imageData||b||"",color:a.color.trim()||"",size:a.size.trim()||"",brand:a.brand.trim()||"",tags:a.tags.trim()||"",notes:a.notes.trim()||"",profileId:m.id})).id,f(n=>n.map((u,y)=>y===c?{...u,id:t,saved:!0}:u))),G(!0),setTimeout(()=>G(!1),1e3),i.every((r,n)=>n===c||r.saved))setTimeout(()=>_(!0),1e3);else{const r=i.findIndex((n,u)=>u!==c&&!n.saved);r!==-1&&setTimeout(()=>S(r),1e3)}}catch(t){console.error("Failed to save item:",t),alert(`Failed to save item: ${t instanceof Error?t.message:"Unknown error"}`)}},q=async()=>{if(a.saved&&a.id){if(!confirm(`Are you sure you want to remove "${a.name}"?`))return;try{await h.mutateAsync(a.id)}catch(r){console.error("Failed to delete item:",r),alert(`Failed to delete item: ${r instanceof Error?r.message:"Unknown error"}`);return}}const t=i.filter((s,r)=>r!==c);t.length===0?o({to:"/wardrobe"}):(f(t),c>=t.length&&S(t.length-1))},V=t=>{t.key==="Enter"&&(t.metaKey||t.ctrlKey)&&R()},W=async()=>{O(!0);const t=i.filter(n=>n.saved&&n.id).map(n=>n.id),s=M?.filter(n=>t.includes(n.id))||[];let r=null;if(I&&s.length>0)try{const n=s.map(v=>v.name),u=s.map(v=>v.color||"Unknown"),y=s.map(v=>v.category);r=await ue(n,u,y)}catch(n){console.error("Failed to generate outfit suggestions:",n)}O(!1),o({to:"/outfits/new",state:{preSelectedItemIds:t,aiGeneratedData:r}})};return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-950 pb-20",onKeyDown:V,children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 px-4 py-4 sticky top-0 z-10",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>o({to:"/wardrobe"}),className:"flex items-center gap-2 text-gray-700 dark:text-gray-300 font-medium",children:[e.jsx(re,{className:"w-5 h-5"}),"Add Item"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i.length>1&&e.jsxs("div",{className:"flex items-center gap-2 mr-2",children:[i.map((t,s)=>e.jsx("button",{onClick:()=>S(s),className:`w-2 h-2 rounded-full transition-all ${s===c?"w-6 bg-purple-500":"bg-gray-300 dark:bg-gray-600 hover:bg-gray-400"}`,"aria-label":`Go to item ${s+1}`},s)),e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:[c+1,"/",i.length]})]}),e.jsx("button",{onClick:q,disabled:h.isPending,className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors disabled:opacity-50",title:a.saved?"Remove item":"Discard item",children:e.jsx(se,{className:"w-5 h-5"})}),e.jsx("button",{onClick:R,disabled:x.isPending||d.isPending||C,className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors disabled:opacity-50",children:x.isPending||d.isPending?a.saved?"Updating...":"Saving...":C?"Saved!":a.saved?"Update":"Save"})]})]}),a.aiGenerated&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-purple-600 dark:text-purple-400",children:[e.jsx(j,{className:"w-3 h-3"}),"AI-generated • Review and edit before saving"]})]}),e.jsxs("div",{className:"px-4 py-6 space-y-6",children:[e.jsxs("section",{className:"bg-white dark:bg-gray-900 rounded-2xl p-6 shadow-sm border border-gray-200 dark:border-gray-800",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Photo"}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[a.imageData||b?e.jsxs("div",{className:"relative w-full aspect-square",children:[e.jsx("img",{src:a.imageData||b,alt:"Item preview",className:"w-full h-full object-cover rounded-xl"}),a.aiGenerated&&a.imageData&&e.jsxs("div",{className:"absolute top-2 left-2 px-2 py-1 bg-purple-500/90 text-white text-xs rounded-full flex items-center gap-1",children:[e.jsx(j,{className:"w-3 h-3"}),"AI Generated"]}),e.jsx("button",{onClick:B,className:"absolute top-2 right-2 p-2 bg-red-500 text-white rounded-full hover:bg-red-600 shadow-lg",children:e.jsx(ne,{className:"w-4 h-4"})})]}):e.jsx("div",{className:"w-full aspect-square bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-950 dark:to-indigo-950 rounded-xl border-2 border-dashed border-blue-300 dark:border-blue-700 flex items-center justify-center",children:e.jsx(le,{className:"w-16 h-16 text-blue-300 dark:text-blue-700"})}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx("input",{ref:N,type:"file",accept:"image/*",capture:"environment",onChange:L,className:"hidden"}),e.jsx("input",{ref:w,type:"file",accept:"image/*",onChange:L,className:"hidden"}),e.jsxs("button",{onClick:()=>N.current?.click(),className:"flex-1 py-3 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 flex items-center justify-center gap-2",disabled:k,children:[e.jsx(oe,{className:"w-5 h-5"}),"Camera"]}),e.jsxs("button",{onClick:()=>w.current?.click(),className:"flex-1 py-3 bg-white dark:bg-gray-800 border-2 border-blue-500 text-blue-600 dark:text-blue-400 rounded-lg font-medium hover:bg-blue-50 dark:hover:bg-gray-700 flex items-center justify-center gap-2",disabled:k,children:[e.jsx(ie,{className:"w-5 h-5"}),"Upload"]})]}),b&&!a.aiGenerated&&e.jsx("button",{onClick:K,disabled:k,className:"w-full py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg font-medium hover:from-purple-600 hover:to-pink-600 transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:k?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-5 h-5 animate-spin"}),T.message]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-5 h-5"}),"AI Analyze Photo"]})}),!I&&b&&e.jsxs("div",{className:"w-full p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg flex items-start gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 text-xs text-amber-700 dark:text-amber-300",children:[e.jsx("button",{onClick:()=>o({to:"/settings/ai"}),className:"underline font-medium",children:"Add Google AI key"})," ","to use AI analysis"]})]})]})]}),e.jsxs("section",{className:"bg-white dark:bg-gray-900 rounded-2xl p-6 shadow-sm border border-gray-200 dark:border-gray-800",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4",children:["Details",i.length>1&&` (Item ${c+1} of ${i.length})`]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",placeholder:"e.g., Blue Denim Jacket",value:a.name,onChange:t=>g({name:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:a.category,onChange:t=>g({category:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"",children:"Select category"}),e.jsx("option",{value:"Top",children:"Top"}),e.jsx("option",{value:"Bottom",children:"Bottom"}),e.jsx("option",{value:"Dress",children:"Dress"}),e.jsx("option",{value:"Outerwear",children:"Outerwear"}),e.jsx("option",{value:"Shoes",children:"Shoes"}),e.jsx("option",{value:"Accessories",children:"Accessories"}),e.jsx("option",{value:"Activewear",children:"Activewear"}),e.jsx("option",{value:"Swimwear",children:"Swimwear"}),e.jsx("option",{value:"Underwear",children:"Underwear"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Color"}),e.jsx("input",{type:"text",placeholder:"e.g., Blue",value:a.color,onChange:t=>g({color:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Size"}),e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-2",children:["XS","S","M","L","XL","2XL","3XL"].map(t=>e.jsx("button",{type:"button",onClick:()=>g({size:t}),className:`py-2 text-sm rounded-lg border transition-colors ${a.size===t?"bg-blue-500 text-white border-blue-500":"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700 hover:border-blue-400"}`,children:t},t))}),e.jsx("input",{type:"text",placeholder:"Or custom size",value:["XS","S","M","L","XL","2XL","3XL"].includes(a.size)?"":a.size,onChange:t=>g({size:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Brand"}),e.jsx("input",{type:"text",placeholder:"e.g., Nike",value:a.brand,onChange:t=>g({brand:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Tags"}),e.jsx("input",{type:"text",placeholder:"e.g., #casual #summer",value:a.tags,onChange:t=>g({tags:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),e.jsx("textarea",{rows:3,placeholder:"Add notes...",value:a.notes,onChange:t=>g({notes:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none resize-none"})]}),a.metadata&&e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(j,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-purple-600 dark:text-purple-400",children:"AI Insights"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[a.metadata.style&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Style:"})," ",e.jsx("span",{className:"font-medium",children:a.metadata.style})]}),a.metadata.occasion&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Occasion:"})," ",e.jsx("span",{className:"font-medium",children:a.metadata.occasion})]}),a.metadata.season&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Season:"})," ",e.jsx("span",{className:"font-medium",children:a.metadata.season})]}),a.metadata.material&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Material:"})," ",e.jsx("span",{className:"font-medium",children:a.metadata.material})]}),a.metadata.pattern&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Pattern:"})," ",e.jsx("span",{className:"font-medium",children:a.metadata.pattern})]})]})]})]})]})]}),C&&e.jsx("div",{className:"fixed bottom-24 left-1/2 transform -translate-x-1/2 z-50 animate-bounce",children:e.jsxs("div",{className:"bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Item saved!"})]})}),X&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow-xl max-w-md w-full p-6 border border-gray-200 dark:border-gray-800",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"All Items Saved!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:(()=>{const t=i.filter(s=>s.saved&&s.id).length;return`You've successfully saved ${t} ${t===1?"item":"items"}. Would you like to create an outfit with ${t===1?"this item":"these items"}?`})()}),I&&e.jsx("div",{className:"mb-4 p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-purple-700 dark:text-purple-300",children:[e.jsx(j,{className:"w-4 h-4"}),e.jsx("span",{children:"AI will suggest outfit details"})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{_(!1),o({to:"/wardrobe"})},disabled:P,className:"flex-1 px-4 py-3 border-2 border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors disabled:opacity-50",children:"No, Thanks"}),e.jsx("button",{onClick:W,disabled:P,className:"flex-1 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg font-medium hover:from-purple-600 hover:to-pink-600 transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:P?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4 animate-spin"}),"Generating..."]}):"Create Outfit"})]})]})})]})})}export{ke as component};
