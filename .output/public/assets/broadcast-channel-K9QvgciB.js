function pe(e){"@babel/helpers - typeof";return pe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pe(e)}function vn(e,t){if(pe(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(pe(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function yn(e){var t=vn(e,"string");return pe(t)=="symbol"?t:t+""}function mn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,yn(n.key),n)}}function rr(e,t,r){return t&&mn(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function gn(e){return e[e.length-1]}function bn(e){return Array.isArray(e)?e.slice(0):[e]}function Js(e,t){e=e.slice(0);for(var r=[];e.length;){var n=e.splice(0,t);r.push(n)}return r}function tt(e){return Array.isArray(e)}function He(e,t){var r=0,n=-1;for(var i of e){n=n+1;var o=t(i,n);if(o)r=r+1;else break}return r}function rt(e,t){var r=t.length;if(r!==0){var n=e.length;e.length=n+t.length;for(var i=0;i<r;++i)e[n+i]=t[i]}}function Zs(e){return e.filter(function(t,r,n){return n.indexOf(t)===r})}function wn(e){for(var t="",r=0;r<e.length;r++){var n=e[r];if(n==="-")return parseInt(t,10);t+=n}throw new Error("malformatted revision: "+e)}function Ct(e,t){var r=t?wn(t._rev)+1:1;return r+"-"+e}function En(e){var t=e.split("."),r=t.length;return r===1?n=>n[e]:n=>{for(var i=n,o=0;o<r;++o){var s=t[o];if(i=i[s],typeof i>"u")return i}return i}}function ve(e){return Object.assign({},e)}function Sn(e){return Object.keys(e)[0]}function nt(e,t=!1){if(!e)return e;if(!t&&Array.isArray(e))return e.sort((n,i)=>typeof n=="string"&&typeof i=="string"?n.localeCompare(i):typeof n=="object"?1:-1).map(n=>nt(n,t));if(typeof e=="object"&&!Array.isArray(e)){var r={};return Object.keys(e).sort((n,i)=>n.localeCompare(i)).forEach(n=>{r[n]=nt(e[n],t)}),r}return e}function it(e){if(!e||e===null||typeof e!="object")return e;if(Array.isArray(e)){for(var t=new Array(e.length),r=t.length;r--;)t[r]=it(e[r]);return t}var n={};for(var i in e)n[i]=it(e[i]);return n}var _n=it;function ea(e,t,r){return Object.defineProperty(e,t,{get:function(){return r}}),r}var wt=1;function ta(){return{lwt:wt}}function ra(){return""}function na(e){return Object.assign({},e,{_meta:void 0,_deleted:void 0,_rev:void 0})}function ia(e,t,r){if(t.length!==r.length)return!1;for(var n=0,i=t.length;n<i;){var o=t[n],s=r[n];if(n++,o[e]!==s[e]||o._rev!==s._rev||o._meta.lwt!==s._meta.lwt)return!1}return!0}function ye(e,t){return ye=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},ye(e,t)}function nr(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,ye(e,t)}function ot(e){return ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ot(e)}function On(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch{return typeof e=="function"}}function ir(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ir=function(){return!!e})()}function In(e,t,r){if(ir())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var i=new(e.bind.apply(e,n));return r&&ye(i,r.prototype),i}function Ne(e){var t=typeof Map=="function"?new Map:void 0;return Ne=function(n){if(n===null||!On(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(n))return t.get(n);t.set(n,i)}function i(){return In(n,arguments,ot(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),ye(i,n)},Ne(e)}var Et={isDevMode(){return!1},deepFreezeWhenDevMode(e){return e},tunnelErrorMessage(e){return`
        RxDB Error-Code: `+e+`.
        Hint: Error messages are not included in RxDB core to reduce build size.
        To show the full error messages and to ensure that you do not make any mistakes when using RxDB,
        use the dev-mode plugin when you are in development mode: https://rxdb.info/dev-mode.html?console=error
        `}};function xn(e){var t="";return Object.keys(e).length===0||(t+="-".repeat(20)+`
`,t+=`Parameters:
`,t+=Object.keys(e).map(r=>{var n="[object Object]";try{r==="errors"?n=e[r].map(i=>JSON.stringify(i,Object.getOwnPropertyNames(i))):n=JSON.stringify(e[r],function(i,o){return o===void 0?null:o},2)}catch{}return r+": "+n}).join(`
`),t+=`
`),t}function or(e,t,r){return`
`+e+`
`+xn(r)}var $n=(function(e){function t(n,i,o={}){var s,a=or(i,n,o);return s=e.call(this,a)||this,s.code=n,s.message=a,s.url=St(n),s.parameters=o,s.rxdb=!0,s}nr(t,e);var r=t.prototype;return r.toString=function(){return this.message},rr(t,[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}])})(Ne(Error)),Pn=(function(e){function t(n,i,o={}){var s,a=or(i,n,o);return s=e.call(this,a)||this,s.code=n,s.message=a,s.url=St(n),s.parameters=o,s.rxdb=!0,s}nr(t,e);var r=t.prototype;return r.toString=function(){return this.message},rr(t,[{key:"name",get:function(){return"RxTypeError ("+this.code+")"}},{key:"typeError",get:function(){return!0}}])})(Ne(TypeError));function St(e){return"https://rxdb.info/errors.html?console=errors#"+e}function sr(e){return`
Find out more about this error here: `+St(e)+` 
`}function k(e,t){return new $n(e,Et.tunnelErrorMessage(e)+sr(e),t)}function oa(e,t){return new Pn(e,Et.tunnelErrorMessage(e)+sr(e),t)}function sa(e){return e&&e.status===409?e:!1}var Rn={409:"document write conflict",422:"schema validation error",510:"attachment data missing"};function aa(e){return k("COL20",{name:Rn[e.status],document:e.documentId,writeError:e})}var Ae;function kn(){if(Ae)return Ae;if(typeof crypto>"u"||typeof crypto.subtle>"u"||typeof crypto.subtle.digest!="function")throw k("UT8",{args:{typeof_crypto:typeof crypto,typeof_crypto_subtle:typeof crypto?.subtle,typeof_crypto_subtle_digest:typeof crypto?.subtle?.digest}});return Ae=crypto.subtle.digest.bind(crypto.subtle),Ae}async function An(e){var t=new TextEncoder().encode(e),r=await kn()("SHA-256",t),n=Array.prototype.map.call(new Uint8Array(r),i=>("00"+i.toString(16)).slice(-2)).join("");return n}var Mn=An;function ua(){return new Promise(e=>setTimeout(e,0))}function Cn(e=0){return new Promise(t=>setTimeout(t,e))}function ca(e){return e&&typeof e.then=="function"?e:Promise.resolve(e)}var fa=Promise.resolve(!0),Tn=Promise.resolve(!1),la=Promise.resolve(null),Nn=Promise.resolve();function Ln(e=1e4){return typeof requestIdleCallback=="function"?new Promise(t=>{requestIdleCallback(()=>t(),{timeout:e})}):Cn(0)}var Ge=Nn;function da(e=void 0){return Ge=Ge.then(()=>Ln(e)),Ge}function ha(e,t){return e.reduce((r,n)=>r.then(n),Promise.resolve(t))}var Dn=/\./g,Tt="abcdefghijklmnopqrstuvwxyz";function Bn(e=10){for(var t="",r=0;r<e;r++)t+=Tt.charAt(Math.floor(Math.random()*Tt.length));return t}function pa(e){e+="";var t=e.charAt(0).toUpperCase();return t+e.substr(1)}function Fn(e){for(;e.charAt(0)===".";)e=e.substr(1);for(;e.slice(-1)===".";)e=e.slice(0,-1);return e}var st=e=>{var t=typeof e;return e!==null&&(t==="object"||t==="function")},Ve=new Set(["__proto__","prototype","constructor"]),Kn=new Set("0123456789");function ar(e){var t=[],r="",n="start",i=!1;for(var o of e)switch(o){case"\\":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd")throw new Error("Invalid character after an index");i&&(r+=o),n="property",i=!i;break}case".":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd"){n="property";break}if(i){i=!1,r+=o;break}if(Ve.has(r))return[];t.push(r),r="",n="property";break}case"[":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd"){n="index";break}if(i){i=!1,r+=o;break}if(n==="property"){if(Ve.has(r))return[];t.push(r),r=""}n="index";break}case"]":{if(n==="index"){t.push(Number.parseInt(r,10)),r="",n="indexEnd";break}if(n==="indexEnd")throw new Error("Invalid character after an index")}default:{if(n==="index"&&!Kn.has(o))throw new Error("Invalid character in an index");if(n==="indexEnd")throw new Error("Invalid character after an index");n==="start"&&(n="property"),i&&(i=!1,r+="\\"),r+=o}}switch(i&&(r+="\\"),n){case"property":{if(Ve.has(r))return[];t.push(r);break}case"index":throw new Error("Index was not closed");case"start":{t.push("");break}}return t}function ur(e,t){if(typeof t!="number"&&Array.isArray(e)){var r=Number.parseInt(t,10);return Number.isInteger(r)&&e[r]===e[t]}return!1}function Un(e,t){if(ur(e,t))throw new Error("Cannot use string index")}function cr(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!t.includes(".")&&!t.includes("["))return e[t];if(!st(e)||typeof t!="string")return r===void 0?e:r;var n=ar(t);if(n.length===0)return r;for(var i=0;i<n.length;i++){var o=n[i];if(ur(e,o)?e=i===n.length-1?void 0:null:e=e[o],e==null){if(i!==n.length-1)return r;break}}return e===void 0?r:e}function va(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!st(e)||typeof t!="string")return e;for(var n=e,i=ar(t),o=0;o<i.length;o++){var s=i[o];Un(e,s),o===i.length-1?e[s]=r:st(e[s])||(e[s]=typeof i[o+1]=="number"?[]:{}),e=e[s]}return n}function ya(e,t){var r=e.get(t);if(typeof r>"u")throw new Error("missing value from map "+t);return r}function jn(e,t,r,n){var i=e.get(t);return typeof i>"u"&&(i=r(),e.set(t,i)),i}var Qe=0;function Wn(){var e=Date.now();e=e+.01,e<=Qe&&(e=Qe+.01);var t=parseFloat(e.toFixed(2));return Qe=t,t}function se(e,t){if(!e)throw t||(t=""),new Error("ensureNotFalsy() is falsy: "+t);return e}var ma={bufferSize:1,refCount:!0},ga="16.20.0",Xe={},qn="6da4936d1425ff3a5c44c02342c6daf791d266be3ae8479b8ec59e261df41b93",ba=16,Ye=Tn,Nt=!1;async function wa(){return Nt||(Nt=!0,Ye=(async()=>!!(Xe.premium&&typeof Xe.premium=="string"&&await Mn(Xe.premium)===qn))()),Ye}var at={preAddRxPlugin:[],preCreateRxDatabase:[],createRxDatabase:[],preCreateRxCollection:[],createRxCollection:[],createRxState:[],postCloseRxCollection:[],postRemoveRxCollection:[],preCreateRxSchema:[],createRxSchema:[],prePrepareRxQuery:[],preCreateRxQuery:[],prePrepareQuery:[],createRxDocument:[],postCreateRxDocument:[],preCreateRxStorageInstance:[],preStorageWrite:[],preMigrateDocument:[],postMigrateDocument:[],preCloseRxDatabase:[],postRemoveRxDatabase:[],postCleanup:[],preReplicationMasterWrite:[],preReplicationMasterWriteDocumentsHandle:[]};function zn(e,t){at[e].length>0&&at[e].forEach(r=>r(t))}async function Ea(e,t){for(var r of at[e])await r(t)}function fr(e,t){var r=t;r=r.replace(Dn,".properties."),r="properties."+r,r=Fn(r);var n=cr(e,r);return n}function Sa(e,t,r){if(typeof t.primaryKey=="string")return r;var n=Hn(t,r),i=r[e];if(i&&i!==n)throw k("DOC19",{args:{documentData:r,existingPrimary:i,newPrimary:n},schema:t});return r[e]=n,r}function W(e){return typeof e=="string"?e:e.key}function _a(e){var t=W(e.primaryKey),r=fr(e,t);return se(r.maxLength)}function Hn(e,t){if(typeof e.primaryKey=="string")return t[e.primaryKey];var r=e.primaryKey;return r.fields.map(n=>{var i=cr(t,n);if(typeof i>"u")throw k("DOC18",{args:{field:n,documentData:t}});return i}).join(r.separator)}function Oa(e){var t=nt(e,!0);return t}function Gn(e){return["_deleted",e]}function Ia(e){e=ve(e);var t=W(e.primaryKey);e.properties=ve(e.properties),e.additionalProperties=!1,Object.prototype.hasOwnProperty.call(e,"keyCompression")||(e.keyCompression=!1),e.indexes=e.indexes?e.indexes.slice(0):[],e.required=e.required?e.required.slice(0):[],e.encrypted=e.encrypted?e.encrypted.slice(0):[],e.properties._rev={type:"string",minLength:1},e.properties._attachments={type:"object"},e.properties._deleted={type:"boolean"},e.properties._meta=Qn,e.required=e.required?e.required.slice(0):[],e.required.push("_deleted"),e.required.push("_rev"),e.required.push("_meta"),e.required.push("_attachments");var r=Xn(e);rt(e.required,r),e.required=e.required.filter(o=>!o.includes(".")).filter((o,s,a)=>a.indexOf(o)===s),e.version=e.version||0;var n=e.indexes.map(o=>{var s=tt(o)?o.slice(0):[o];return s.includes(t)||s.push(t),s[0]!=="_deleted"&&s.unshift("_deleted"),s});n.length===0&&n.push(Gn(t)),n.push(["_meta.lwt",t]),e.internalIndexes&&e.internalIndexes.map(o=>{n.push(o)});var i=new Set;return n.filter(o=>{var s=o.join(",");return i.has(s)?!1:(i.add(s),!0)}),e.indexes=n,e}var Vn=1e15,Qn={type:"object",properties:{lwt:{type:"number",minimum:wt,maximum:Vn,multipleOf:.01}},additionalProperties:!0,required:["lwt"]};function Xn(e){var t=Object.keys(e.properties).filter(n=>e.properties[n].final),r=W(e.primaryKey);return t.push(r),typeof e.primaryKey!="string"&&e.primaryKey.fields.forEach(n=>t.push(n)),t}function xa(e,t){for(var r=Object.keys(e.defaultValues),n=0;n<r.length;++n){var i=r[n];(!Object.prototype.hasOwnProperty.call(t,i)||typeof t[i]>"u")&&(t[i]=e.defaultValues[i])}return t}function I(e){return typeof e=="function"}function Yn(e){return I(e?.lift)}function te(e){return function(t){if(Yn(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}var ut=function(e,t){return ut=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},ut(e,t)};function _e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");ut(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function Jn(e,t,r,n){function i(o){return o instanceof r?o:new r(function(s){s(o)})}return new(r||(r=Promise))(function(o,s){function a(f){try{c(n.next(f))}catch(l){s(l)}}function u(f){try{c(n.throw(f))}catch(l){s(l)}}function c(f){f.done?o(f.value):i(f.value).then(a,u)}c((n=n.apply(e,t||[])).next())})}function lr(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(f){return u([c,f])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,c[0]&&(r=0)),r;)try{if(n=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){r.label=c[1];break}if(c[0]===6&&r.label<o[1]){r.label=o[1],o=c;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(c);break}o[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(e,r)}catch(f){c=[6,f],i=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function ae(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ct(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,o=[],s;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o}function ft(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}function ie(e){return this instanceof ie?(this.v=e,this):new ie(e)}function Zn(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),i[Symbol.asyncIterator]=function(){return this},i;function s(d){return function(h){return Promise.resolve(h).then(d,l)}}function a(d,h){n[d]&&(i[d]=function(v){return new Promise(function(y,O){o.push([d,v,y,O])>1||u(d,v)})},h&&(i[d]=h(i[d])))}function u(d,h){try{c(n[d](h))}catch(v){p(o[0][3],v)}}function c(d){d.value instanceof ie?Promise.resolve(d.value.v).then(f,l):p(o[0][2],d)}function f(d){u("next",d)}function l(d){u("throw",d)}function p(d,h){d(h),o.shift(),o.length&&u(o[0][0],o[0][1])}}function ei(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof ae=="function"?ae(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=e[o]&&function(s){return new Promise(function(a,u){s=e[o](s),i(a,u,s.done,s.value)})}}function i(o,s,a,u){Promise.resolve(u).then(function(c){o({value:c,done:a})},s)}}var dr=(function(e){return e&&typeof e.length=="number"&&typeof e!="function"});function hr(e){return I(e?.then)}function pr(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var Je=pr(function(e){return function(r){e(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function lt(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var Fe=(function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,r,n,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=ae(s),u=a.next();!u.done;u=a.next()){var c=u.value;c.remove(this)}}catch(v){t={error:v}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}else s.remove(this);var f=this.initialTeardown;if(I(f))try{f()}catch(v){o=v instanceof Je?v.errors:[v]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var p=ae(l),d=p.next();!d.done;d=p.next()){var h=d.value;try{Lt(h)}catch(v){o=o??[],v instanceof Je?o=ft(ft([],ct(o)),ct(v.errors)):o.push(v)}}}catch(v){n={error:v}}finally{try{d&&!d.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}}if(o)throw new Je(o)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)Lt(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&lt(r,t)},e.prototype.remove=function(t){var r=this._finalizers;r&&lt(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=(function(){var t=new e;return t.closed=!0,t})(),e})(),vr=Fe.EMPTY;function yr(e){return e instanceof Fe||e&&"closed"in e&&I(e.remove)&&I(e.add)&&I(e.unsubscribe)}function Lt(e){I(e)?e():e.unsubscribe()}var ti={Promise:void 0},ri={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return setTimeout.apply(void 0,ft([e,t],ct(r)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function mr(e){ri.setTimeout(function(){throw e})}function Dt(){}function Ce(e){e()}var _t=(function(e){_e(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,yr(r)&&r.add(n)):n.destination=oi,n}return t.create=function(r,n,i){return new dt(r,n,i)},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t})(Fe),ni=(function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var r=this.partialObserver;if(r.next)try{r.next(t)}catch(n){Me(n)}},e.prototype.error=function(t){var r=this.partialObserver;if(r.error)try{r.error(t)}catch(n){Me(n)}else Me(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(r){Me(r)}},e})(),dt=(function(e){_e(t,e);function t(r,n,i){var o=e.call(this)||this,s;return I(r)||!r?s={next:r??void 0,error:n??void 0,complete:i??void 0}:s=r,o.destination=new ni(s),o}return t})(_t);function Me(e){mr(e)}function ii(e){throw e}var oi={closed:!0,next:Dt,error:ii,complete:Dt},Ot=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function gr(e){return e}function si(e){return e.length===0?gr:e.length===1?e[0]:function(r){return e.reduce(function(n,i){return i(n)},r)}}var D=(function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var i=this,o=ui(t)?t:new dt(t,r,n);return Ce(function(){var s=i,a=s.operator,u=s.source;o.add(a?a.call(o,u):u?i._subscribe(o):i._trySubscribe(o))}),o},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},e.prototype.forEach=function(t,r){var n=this;return r=Bt(r),new r(function(i,o){var s=new dt({next:function(a){try{t(a)}catch(u){o(u),s.unsubscribe()}},error:o,complete:i});n.subscribe(s)})},e.prototype._subscribe=function(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)},e.prototype[Ot]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return si(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=Bt(t),new t(function(n,i){var o;r.subscribe(function(s){return o=s},function(s){return i(s)},function(){return n(o)})})},e.create=function(t){return new e(t)},e})();function Bt(e){var t;return(t=e??ti.Promise)!==null&&t!==void 0?t:Promise}function ai(e){return e&&I(e.next)&&I(e.error)&&I(e.complete)}function ui(e){return e&&e instanceof _t||ai(e)&&yr(e)}function br(e){return I(e[Ot])}function wr(e){return Symbol.asyncIterator&&I(e?.[Symbol.asyncIterator])}function Er(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function ci(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Sr=ci();function _r(e){return I(e?.[Sr])}function Or(e){return Zn(this,arguments,function(){var r,n,i,o;return lr(this,function(s){switch(s.label){case 0:r=e.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,ie(r.read())];case 3:return n=s.sent(),i=n.value,o=n.done,o?[4,ie(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,ie(i)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function Ir(e){return I(e?.getReader)}function ce(e){if(e instanceof D)return e;if(e!=null){if(br(e))return fi(e);if(dr(e))return li(e);if(hr(e))return di(e);if(wr(e))return xr(e);if(_r(e))return hi(e);if(Ir(e))return pi(e)}throw Er(e)}function fi(e){return new D(function(t){var r=e[Ot]();if(I(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function li(e){return new D(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}function di(e){return new D(function(t){e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,mr)})}function hi(e){return new D(function(t){var r,n;try{for(var i=ae(e),o=i.next();!o.done;o=i.next()){var s=o.value;if(t.next(s),t.closed)return}}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}t.complete()})}function xr(e){return new D(function(t){vi(e,t).catch(function(r){return t.error(r)})})}function pi(e){return xr(Or(e))}function vi(e,t){var r,n,i,o;return Jn(this,void 0,void 0,function(){var s,a;return lr(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),r=ei(e),u.label=1;case 1:return[4,r.next()];case 2:if(n=u.sent(),!!n.done)return[3,4];if(s=n.value,t.next(s),t.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=u.sent(),i={error:a},[3,11];case 6:return u.trys.push([6,,9,10]),n&&!n.done&&(o=r.return)?[4,o.call(r)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function J(e,t,r,n,i){return new yi(e,t,r,n,i)}var yi=(function(e){_e(t,e);function t(r,n,i,o,s,a){var u=e.call(this,r)||this;return u.onFinalize=s,u.shouldUnsubscribe=a,u._next=n?function(c){try{n(c)}catch(f){r.error(f)}}:e.prototype._next,u._error=o?function(c){try{o(c)}catch(f){r.error(f)}finally{this.unsubscribe()}}:e.prototype._error,u._complete=i?function(){try{i()}catch(c){r.error(c)}finally{this.unsubscribe()}}:e.prototype._complete,u}return t.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},t})(_t);function mi(e){return e&&I(e.schedule)}function It(e){return e[e.length-1]}function $a(e){return I(It(e))?e.pop():void 0}function $r(e){return mi(It(e))?e.pop():void 0}function Pa(e,t){return typeof It(e)=="number"?e.pop():t}function V(e,t,r,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var o=t.schedule(function(){r(),i?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(o),!i)return o}function Pr(e,t){return t===void 0&&(t=0),te(function(r,n){r.subscribe(J(n,function(i){return V(n,e,function(){return n.next(i)},t)},function(){return V(n,e,function(){return n.complete()},t)},function(i){return V(n,e,function(){return n.error(i)},t)}))})}function Rr(e,t){return t===void 0&&(t=0),te(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function gi(e,t){return ce(e).pipe(Rr(t),Pr(t))}function bi(e,t){return ce(e).pipe(Rr(t),Pr(t))}function wi(e,t){return new D(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}function Ei(e,t){return new D(function(r){var n;return V(r,t,function(){n=e[Sr](),V(r,t,function(){var i,o,s;try{i=n.next(),o=i.value,s=i.done}catch(a){r.error(a);return}s?r.complete():r.next(o)},0,!0)}),function(){return I(n?.return)&&n.return()}})}function kr(e,t){if(!e)throw new Error("Iterable cannot be null");return new D(function(r){V(r,t,function(){var n=e[Symbol.asyncIterator]();V(r,t,function(){n.next().then(function(i){i.done?r.complete():r.next(i.value)})},0,!0)})})}function Si(e,t){return kr(Or(e),t)}function _i(e,t){if(e!=null){if(br(e))return gi(e,t);if(dr(e))return wi(e,t);if(hr(e))return bi(e,t);if(wr(e))return kr(e,t);if(_r(e))return Ei(e,t);if(Ir(e))return Si(e,t)}throw Er(e)}function Oi(e,t){return t?_i(e,t):ce(e)}function ht(e,t){return te(function(r,n){var i=0;r.subscribe(J(n,function(o){n.next(e.call(t,o,i++))}))})}function Ii(e,t,r,n,i,o,s,a){var u=[],c=0,f=0,l=!1,p=function(){l&&!u.length&&!c&&t.complete()},d=function(v){return c<n?h(v):u.push(v)},h=function(v){c++;var y=!1;ce(r(v,f++)).subscribe(J(t,function(O){t.next(O)},function(){y=!0},void 0,function(){if(y)try{c--;for(var O=function(){var m=u.shift();s||h(m)};u.length&&c<n;)O();p()}catch(m){t.error(m)}}))};return e.subscribe(J(t,d,function(){l=!0,p()})),function(){}}function Ar(e,t,r){return r===void 0&&(r=1/0),I(t)?Ar(function(n,i){return ht(function(o,s){return t(n,o,i,s)})(ce(e(n,i)))},r):(typeof t=="number"&&(r=t),te(function(n,i){return Ii(n,i,e,r)}))}function xi(e){return e===void 0&&(e=1/0),Ar(gr,e)}function $i(){return xi(1)}var Pi=pr(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Ri=(function(e){_e(t,e);function t(){var r=e.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype.lift=function(r){var n=new Ft(this,this);return n.operator=r,n},t.prototype._throwIfClosed=function(){if(this.closed)throw new Pi},t.prototype.next=function(r){var n=this;Ce(function(){var i,o;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var s=ae(n.currentObservers),a=s.next();!a.done;a=s.next()){var u=a.value;u.next(r)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}})},t.prototype.error=function(r){var n=this;Ce(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var i=n.observers;i.length;)i.shift().error(r)}})},t.prototype.complete=function(){var r=this;Ce(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(r){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},t.prototype._innerSubscribe=function(r){var n=this,i=this,o=i.hasError,s=i.isStopped,a=i.observers;return o||s?vr:(this.currentObservers=null,a.push(r),new Fe(function(){n.currentObservers=null,lt(a,r)}))},t.prototype._checkFinalizedStatuses=function(r){var n=this,i=n.hasError,o=n.thrownError,s=n.isStopped;i?r.error(o):s&&r.complete()},t.prototype.asObservable=function(){var r=new D;return r.source=this,r},t.create=function(r,n){return new Ft(r,n)},t})(D),Ft=(function(e){_e(t,e);function t(r,n){var i=e.call(this)||this;return i.destination=r,i.source=n,i}return t.prototype.next=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,r)},t.prototype.error=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,r)},t.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},t.prototype._subscribe=function(r){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&i!==void 0?i:vr},t})(Ri);function Kt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return $i()(Oi(e,$r(e)))}function Ut(e,t){return te(function(r,n){var i=0;r.subscribe(J(n,function(o){return e.call(t,o,i++)&&n.next(o)}))})}function ki(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=$r(e);return te(function(n,i){(r?Kt(e,n,r):Kt(e,n)).subscribe(i)})}function Ai(e,t){return te(function(r,n){var i=null,o=0,s=!1,a=function(){return s&&!i&&n.complete()};r.subscribe(J(n,function(u){i?.unsubscribe();var c=0,f=o++;ce(e(u,f)).subscribe(i=J(n,function(l){return n.next(t?t(u,l,f,c++):l)},function(){i=null,a()}))},function(){s=!0,a()}))})}var le="ï¿¿",de=Number.MIN_SAFE_INTEGER;function Mi(e,t){var r=t.selector,n=e.indexes?e.indexes.slice(0):[];t.index&&(n=[t.index]);var i=!!t.sort.find(f=>Object.values(f)[0]==="desc"),o=new Set;Object.keys(r).forEach(f=>{var l=fr(e,f);l&&l.type==="boolean"&&Object.prototype.hasOwnProperty.call(r[f],"$eq")&&o.add(f)});var s=t.sort.map(f=>Object.keys(f)[0]),a=s.filter(f=>!o.has(f)).join(","),u=-1,c;if(n.forEach(f=>{var l=!0,p=!0,d=f.map(m=>{var w=r[m],P=w?Object.keys(w):[],E={};if(!w||!P.length){var b=p?de:le;E={startKey:b,endKey:l?le:de,inclusiveStart:!0,inclusiveEnd:!0}}else P.forEach(S=>{if(xt.has(S)){var _=w[S],R=Li(S,_);E=Object.assign(E,R)}});return typeof E.startKey>"u"&&(E.startKey=de),typeof E.endKey>"u"&&(E.endKey=le),typeof E.inclusiveStart>"u"&&(E.inclusiveStart=!0),typeof E.inclusiveEnd>"u"&&(E.inclusiveEnd=!0),p&&!E.inclusiveStart&&(p=!1),l&&!E.inclusiveEnd&&(l=!1),E}),h=d.map(m=>m.startKey),v=d.map(m=>m.endKey),y={index:f,startKeys:h,endKeys:v,inclusiveEnd:l,inclusiveStart:p,sortSatisfiedByIndex:!i&&a===f.filter(m=>!o.has(m)).join(","),selectorSatisfiedByIndex:Ni(f,t.selector,h,v)},O=Di(e,t,y);(O>=u||t.index)&&(u=O,c=y)}),!c)throw k("SNH",{query:t});return c}var xt=new Set(["$eq","$gt","$gte","$lt","$lte"]),Ci=new Set(["$eq","$gt","$gte"]),Ti=new Set(["$eq","$lt","$lte"]);function Ni(e,t,r,n){var i=Object.entries(t),o=i.find(([S,_])=>{if(!e.includes(S))return!0;var R=Object.entries(_).find(([q,qe])=>!xt.has(q));return R});if(o||t.$and||t.$or)return!1;var s=[],a=new Set;for(var[u,c]of Object.entries(t)){if(!e.includes(u))return!1;var f=Object.keys(c).filter(S=>Ci.has(S));if(f.length>1)return!1;var l=f[0];if(l&&a.add(u),l!=="$eq"){if(s.length>0)return!1;s.push(l)}}var p=[],d=new Set;for(var[h,v]of Object.entries(t)){if(!e.includes(h))return!1;var y=Object.keys(v).filter(S=>Ti.has(S));if(y.length>1)return!1;var O=y[0];if(O&&d.add(h),O!=="$eq"){if(p.length>0)return!1;p.push(O)}}var m=0;for(var w of e){for(var P of[a,d]){if(!P.has(w)&&P.size>0)return!1;P.delete(w)}var E=r[m],b=n[m];if(E!==b&&a.size>0&&d.size>0)return!1;m++}return!0}function Li(e,t){switch(e){case"$eq":return{startKey:t,endKey:t,inclusiveEnd:!0,inclusiveStart:!0};case"$lte":return{endKey:t,inclusiveEnd:!0};case"$gte":return{startKey:t,inclusiveStart:!0};case"$lt":return{endKey:t,inclusiveEnd:!1};case"$gt":return{startKey:t,inclusiveStart:!1};default:throw new Error("SNH")}}function Di(e,t,r){var n=0,i=f=>{f>0&&(n=n+f)},o=10,s=He(r.startKeys,f=>f!==de&&f!==le);i(s*o);var a=He(r.startKeys,f=>f!==le&&f!==de);i(a*o);var u=He(r.startKeys,(f,l)=>f===r.endKeys[l]);i(u*o*1.5);var c=r.sortSatisfiedByIndex?5:0;return i(c),n}class Ke extends Error{}const me=Symbol("missing"),Mr=Object.freeze(new Error("mingo: cycle detected while processing object/array")),Ue=e=>{const t=Te(e);let r=0,n=t.length;for(;n;)r=(r<<5)-r^t.charCodeAt(--n);return r>>>0},K=e=>typeof e!="object"&&typeof e!="function"||e===null,Cr=e=>K(e)||be(e)||Q(e),Tr={undefined:1,null:2,number:3,string:4,symbol:5,object:6,array:7,arraybuffer:8,boolean:9,date:10,regexp:11,function:12},j=(e,t)=>{e===me&&(e=void 0),t===me&&(t=void 0);const[r,n]=[e,t].map(i=>Tr[ge(i)]||0);return r!==n?r-n:U(e,t)?0:e<t?-1:e>t?1:0};class Le extends Map{#e=Ue;#r=new Map;#t=t=>{const r=this.#e(t);return[(this.#r.get(r)||[]).find(n=>U(n,t)),r]};constructor(){super()}static init(t){const r=new Le;return t&&(r.#e=t),r}clear(){super.clear(),this.#r.clear()}delete(t){if(K(t))return super.delete(t);const[r,n]=this.#t(t);return super.delete(r)?(this.#r.set(n,this.#r.get(n).filter(i=>!U(i,r))),!0):!1}get(t){if(K(t))return super.get(t);const[r,n]=this.#t(t);return super.get(r)}has(t){if(K(t))return super.has(t);const[r,n]=this.#t(t);return super.has(r)}set(t,r){if(K(t))return super.set(t,r);const[n,i]=this.#t(t);if(super.has(n))super.set(n,r);else{super.set(t,r);const o=this.#r.get(i)||[];o.push(t),this.#r.set(i,o)}return this}get size(){return super.size}}function x(e,t){if(!e)throw new Ke(t)}const Bi=Object.keys(Tr).reduce((e,t)=>(e["[object "+t[0].toUpperCase()+t.substring(1)+"]"]=t,e),{});function ge(e){const t=Object.prototype.toString.call(e);return t==="[object Object]"?e?.constructor?.name?.toLowerCase()||"object":Bi[t]||t.substring(8,t.length-1).toLowerCase()}const oe=e=>typeof e=="boolean",B=e=>typeof e=="string",Fi=e=>typeof e=="symbol",M=e=>!isNaN(e)&&typeof e=="number",g=Array.isArray;function $(e){if(!e)return!1;const t=Object.getPrototypeOf(e);return(t===Object.prototype||t===null)&&ge(e)==="object"}const Nr=e=>!K(e),be=e=>e instanceof Date,Q=e=>e instanceof RegExp,$t=e=>typeof e=="function",C=e=>e==null,Ki=(e,t=!0)=>!!e||t&&e==="",Pt=e=>C(e)||B(e)&&!e||g(e)&&e.length===0||$(e)&&Object.keys(e).length===0,Oe=e=>g(e)?e:[e],ue=(e,t)=>!!e&&Object.prototype.hasOwnProperty.call(e,t),Ui=e=>typeof ArrayBuffer<"u"&&ArrayBuffer.isView(e),we=(e,t)=>{if(C(e)||oe(e)||M(e)||B(e))return e;if(be(e))return new Date(e);if(Q(e))return new RegExp(e);if(Ui(e)){const r=e.constructor;return new r(e)}if(t instanceof Set||(t=new Set),t.has(e))throw Mr;t.add(e);try{if(g(e)){const r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=we(e[n],t);return r}if($(e)){const r={};for(const n of Object.keys(e))r[n]=we(e[n],t);return r}}finally{t.delete(e)}return e},jt=e=>e===me;function pt(e,t){if(jt(e)||C(e))return t;if(jt(t)||C(t))return e;if(K(e)||K(t))return t;g(e)&&g(t)&&x(e.length===t.length,"arrays must be of equal length to merge.");for(const r of Object.keys(t))e[r]=pt(e[r],t[r]);return e}function ji(e,t=Ue){const r=[Le.init(t),Le.init(t)];if(e.length===0)return[];if(e.some(n=>n.length===0))return[];if(e.length===1)return[...e];e[e.length-1].forEach(n=>r[0].set(n,!0));for(let n=e.length-2;n>-1;n--){if(e[n].forEach(i=>{r[0].has(i)&&r[1].set(i,!0)}),r[1].size===0)return[];r.reverse(),r[1].clear()}return Array.from(r[0].keys())}function Lr(e,t=1){const r=new Array;function n(i,o){for(let s=0,a=i.length;s<a;s++)g(i[s])&&(o>0||o<0)?n(i[s],Math.max(-1,o-1)):r.push(i[s])}return n(e,t),r}function Wi(e){const t={};for(;e;){for(const r of Object.getOwnPropertyNames(e))r in t||(t[r]=e[r]);e=Object.getPrototypeOf(e)}return t}function Dr(e){for(;e;){if(Object.getOwnPropertyNames(e).includes("toString"))return e.toString!==Object.prototype.toString;e=Object.getPrototypeOf(e)}return!1}function U(e,t){if(e===t||Object.is(e,t))return!0;if(e===null||t===null||typeof e!=typeof t||typeof e!="object"||e.constructor!==t.constructor)return!1;if(e instanceof Date)return+e==+t;if(e instanceof RegExp)return e.toString()===t.toString();const r=e.constructor;if(r===Array||r===Object){const n=Object.keys(e).sort(),i=Object.keys(t).sort();if(n.length!==i.length)return!1;for(let o=0,s=n[o];o<n.length;s=n[++o])if(s!==i[o]||!U(e[s],t[s]))return!1;return!0}return Dr(e)&&e.toString()===t.toString()}const Te=(e,t)=>{if(e===null)return"null";if(e===void 0)return"undefined";if(B(e)||M(e)||oe(e))return JSON.stringify(e);if(be(e))return e.toISOString();if(Q(e)||Fi(e)||$t(e))return e.toString();if(t instanceof Set||(t=new Set),t.has(e))throw Mr;try{if(t.add(e),g(e))return"["+e.map(n=>Te(n,t)).join(",")+"]";if($(e))return"{"+Object.keys(e).sort().map(i=>`${i}:${Te(e[i],t)}`).join()+"}";const r=Dr(e)?e.toString():Te(Wi(e),t);return ge(e)+"("+r+")"}finally{t.delete(e)}};function qi(e,t){return C(e)?null:(t=t||Ue,t(e))}function zi(e,t,r=Ue){if(e.length<1)return new Map;const n=new Map,i=new Map;for(let o=0;o<e.length;o++){const s=e[o],a=t(s,o),u=qi(a,r);if(u===null)i.has(null)?i.get(null).push(s):i.set(null,[s]);else{const c=n.has(u)?n.get(u).find(f=>U(f,a)):null;C(c)?(i.set(a,[s]),n.has(u)?n.get(u).push(a):n.set(u,[a])):i.get(c).push(s)}}return i}function vt(e,t){return Nr(e)?e[t]:void 0}function Hi(e,t){if(t<1)return e;for(;t--&&e.length===1;)e=e[0];return e}function Z(e,t,r){let n=0;function i(s,a){let u=s;for(let c=0;c<a.length;c++){const f=a[c];if(/^\d+$/.exec(f)===null&&g(u)){if(c===0&&n>0)break;n+=1;const p=a.slice(c);u=u.reduce((d,h)=>{const v=i(h,p);return v!==void 0&&d.push(v),d},[]);break}else u=vt(u,f);if(u===void 0)break}return u}const o=Cr(e)?e:i(e,t.split("."));return g(o)&&r?.unwrapArray?Hi(o,n):o}function he(e,t,r){const n=t.indexOf("."),i=n==-1?t:t.substring(0,n),o=t.substring(n+1),s=n!=-1;if(g(e)){const c=/^\d+$/.test(i),f=c&&r?.preserveIndex?[...e]:[];if(c){const l=parseInt(i);let p=vt(e,l);s&&(p=he(p,o,r)),r?.preserveIndex?f[l]=p:f.push(p)}else for(const l of e){const p=he(l,t,r);r?.preserveMissing?f.push(p??me):(p!=null||r?.preserveIndex)&&f.push(p)}return f}const a=r?.preserveKeys?{...e}:{};let u=vt(e,i);if(s&&(u=he(u,o,r)),u!==void 0)return a[i]=u,a}function yt(e){if(g(e))for(let t=e.length-1;t>=0;t--)e[t]===me?e.splice(t,1):yt(e[t]);else if($(e))for(const t in e)ue(e,t)&&yt(e[t])}const Wt=/^\d+$/;function De(e,t,r,n){const i=t.split("."),o=i[0],s=i.slice(1).join(".");if(i.length===1)($(e)||g(e)&&Wt.test(o))&&r(e,o);else{n?.buildGraph&&C(e[o])&&(e[o]={});const a=e[o];if(!a)return;const u=!!(i.length>1&&Wt.test(i[1]));g(a)&&n?.descendArray&&!u?a.forEach(c=>De(c,s,r,n)):De(a,s,r,n)}}function Gi(e,t,r){De(e,t,(n,i)=>{n[i]=$t(r)?r(n[i]):r},{buildGraph:!0})}function qt(e,t,r){De(e,t,(n,i)=>{if(g(n)){if(/^\d+$/.test(i))n.splice(parseInt(i),1);else if(r&&r.descendArray)for(const o of n)$(o)&&delete o[i]}else $(n)&&delete n[i]},r)}const Vi=/^\$[a-zA-Z0-9_]+$/;function re(e){return Vi.test(e)}function Br(e){if(Cr(e))return Q(e)?{$regex:e}:{$eq:e};if(Nr(e)){if(!Object.keys(e).some(re))return{$eq:e};if(ue(e,"$regex")){const t={...e};return t.$regex=new RegExp(e.$regex,e.$options),delete t.$options,t}}return e}var mt=(e=>(e[e.CLONE_OFF=0]="CLONE_OFF",e[e.CLONE_INPUT=1]="CLONE_INPUT",e[e.CLONE_OUTPUT=2]="CLONE_OUTPUT",e[e.CLONE_ALL=3]="CLONE_ALL",e))(mt||{});class X{#e;#r;#t;constructor(t,r,n){this.#e=t,this.update(r,n)}static init(t,r,n){return t instanceof X?new X(t.#e,t.root??r,{...t.#t,...n,variables:Object.assign({},t.#t?.variables,n?.variables)}):new X(t,r,n)}update(t,r){this.#r=t;const n=Object.assign({},this.#t?.variables,r?.variables);return Object.keys(n).length?this.#t={...r,variables:n}:this.#t=r??{},this}getOptions(){return Object.freeze({...this.#e,context:ee.from(this.#e.context)})}get root(){return this.#r}get local(){return this.#t}get idKey(){return this.#e.idKey}get collation(){return this.#e?.collation}get processingMode(){return this.#e?.processingMode||0}get useStrictMode(){return this.#e?.useStrictMode}get scriptEnabled(){return this.#e?.scriptEnabled}get useGlobalContext(){return this.#e?.useGlobalContext}get hashFunction(){return this.#e?.hashFunction}get collectionResolver(){return this.#e?.collectionResolver}get jsonSchemaValidator(){return this.#e?.jsonSchemaValidator}get variables(){return this.#e?.variables}get context(){return this.#e?.context}}function Qi(e){return e instanceof X?e.getOptions():Object.freeze({idKey:"_id",scriptEnabled:!0,useStrictMode:!0,useGlobalContext:!0,processingMode:0,...e,context:e?.context?ee.from(e?.context):ee.init()})}class ee{#e=new Map;constructor(){}static init(){return new ee}static from(t){const r=ee.init();return C(t)||t.#e.forEach((n,i)=>r.addOperators(i,n)),r}addOperators(t,r){this.#e.has(t)||this.#e.set(t,{});for(const[n,i]of Object.entries(r))this.getOperator(t,n)||(this.#e.get(t)[n]=i);return this}getOperator(t,r){return(this.#e.get(t)??{})[r]??null}addAccumulatorOps(t){return this.addOperators("accumulator",t)}addExpressionOps(t){return this.addOperators("expression",t)}addQueryOps(t){return this.addOperators("query",t)}addPipelineOps(t){return this.addOperators("pipeline",t)}addProjectionOps(t){return this.addOperators("projection",t)}addWindowOps(t){return this.addOperators("window",t)}}const H=ee.init();function zt(e,t){for(const[r,n]of Object.entries(t)){x($t(n)&&re(r),`'${r}' is not a valid operator`);const i=Ee(e,r,null);x(!i||n===i,`${r} already exists for '${e}' operators. Cannot change operator function once registered.`)}switch(e){case"accumulator":H.addAccumulatorOps(t);break;case"expression":H.addExpressionOps(t);break;case"pipeline":H.addPipelineOps(t);break;case"projection":H.addProjectionOps(t);break;case"query":H.addQueryOps(t);break;case"window":H.addWindowOps(t);break}}function Ee(e,t,r){const{context:n,useGlobalContext:i}=r||{},o=n?n.getOperator(e,t):null;return!o&&i?H.getOperator(e,t):o}function ne(e,t,r,n){const i=X.init(n,e);return r&&re(r)?Fr(e,t,r,i):Be(e,t,i)}const Xi=["$$ROOT","$$CURRENT","$$REMOVE","$$NOW"];function Be(e,t,r){if(B(t)&&t.length>0&&t[0]==="$"){if(Yi.includes(t))return t;let n=r.root;const i=t.split(".");if(Xi.includes(i[0])){switch(i[0]){case"$$ROOT":break;case"$$CURRENT":n=e;break;case"$$REMOVE":n=void 0;break;case"$$NOW":n=new Date;break}t=t.slice(i[0].length+1)}else if(i[0].slice(0,2)==="$$"){n=Object.assign({},r.variables,{this:e},r?.local?.variables);const o=i[0].slice(2);x(ue(n,o),`Use of undefined variable: ${o}`),t=t.slice(2)}else t=t.slice(1);return t===""?n:Z(n,t)}if(g(t))return t.map(n=>Be(e,n,r));if($(t)){const n={},i=Object.entries(t);for(const[o,s]of i){if(re(o))return x(i.length==1,"expression must have single operator."),Fr(e,s,o,r);n[o]=Be(e,s,r)}return n}return t}function Fr(e,t,r,n){const i=Ee("expression",r,n);if(i)return i(e,t,n);const o=Ee("accumulator",r,n);return x(!!o,`accumulator '${r}' is not registered.`),g(e)||(e=Be(e,t,n),t=null),x(g(e),`arguments must resolve to array for ${r}.`),o(e,t,n)}const Yi=["$$KEEP","$$PRUNE","$$DESCEND"];function Se(e){return e instanceof Ht?e:new Ht(e)}function Ji(...e){let t=0;return Se(()=>{for(;t<e.length;){const r=e[t].next();if(!r.done)return r;t++}return{done:!0}})}function Zi(e){return!!e&&typeof e=="object"&&e?.next instanceof Function}function eo(e,t){const r=e.slice(t+1);e.splice(t),Array.prototype.push.apply(e,r)}const gt=new Error;function to(e,t,r){let n=!1,i=-1,o=0;return function(s){try{e:for(;!n;){let a=e();i++;let u=-1;const c=t.length;let f=!1;for(;++u<c;){const l=t[u];switch(l.action){case 0:a=l.func(a,i);break;case 1:if(!l.func(a,i))continue e;break;case 2:--l.count,l.count||(f=!0);break;case 3:--l.count,l.count||eo(t,u);continue e;default:break e}}if(n=f,s)r[o++]=a;else return{value:a,done:!1}}}catch(a){if(a!==gt)throw a}return n=!0,{done:n}}}let Ht=class{constructor(t){this.#e=[],this.#r=[],this.isDone=!1;let r;if(t instanceof Function&&(t={next:t}),Zi(t)){const n=t;r=()=>{const i=n.next();if(i.done)throw gt;return i.value}}else if(g(t)){const n=t,i=n.length;let o=0;r=()=>{if(o<i)return n[o++];throw gt}}else if(!(t instanceof Function))throw new Ke("Lazy must be initialized with an array, generator, or function.");this.#t=to(r,this.#e,this.#r)}#e;#r;#t;push(t,r){return typeof r=="function"?this.#e.push({action:t,func:r}):typeof r=="number"&&this.#e.push({action:t,count:r}),this}next(){return this.#t()}map(t){return this.push(0,t)}filter(t){return this.push(1,t)}take(t){return t>0?this.push(2,t):this}drop(t){return t>0?this.push(3,t):this}transform(t){const r=this;let n;return Se(()=>(n||(n=Se(t(r.value()))),n.next()))}value(){return this.isDone||(this.isDone=this.#t(!0).done),this.#r}each(t){for(;;){const r=this.next();if(r.done)break;if(t(r.value)===!1)return!1}return!0}reduce(t,r){let n=this.next();for(r===void 0&&!n.done&&(r=n.value,n=this.next());!n.done;)r=t(r,n.value),n=this.next();return r}size(){return this.reduce((t,r)=>++t,0)}[Symbol.iterator](){return this}};const ro=(e,t,r)=>e.take(t),Kr=(e,t,r)=>Pt(t)?e:(jr(t,r),e.map(Ur(t,X.init(r))));function Ur(e,t,r=!0){const n=t.idKey,i=Object.keys(e),o=new Array,s=new Array,a={};for(const d of i){const h=e[d];if(M(h)||oe(h))h?s.push(d):o.push(d);else if(g(h))a[d]=v=>h.map(y=>ne(v,y,null,t.update(v))??null);else if($(h)){const v=Object.keys(h),y=v.length==1?v[0]:"",O=Ee("projection",y,t);O?y==="$slice"&&!Oe(h[y]).every(M)?a[d]=w=>ne(w,h,d,t.update(w)):a[d]=w=>O(w,h[y],d,t.update(w)):re(y)?a[d]=m=>ne(m,h[y],y,t):(jr(h,t),a[d]=m=>{if(!ue(m,d))return ne(m,h,null,t);r&&t.update(m);const w=Z(m,d),P=Ur(h,t,!1);return g(w)?w.map(P):$(w)?P(w):P(m)})}else a[d]=B(h)&&h[0]==="$"?v=>ne(v,h,d,t):v=>h}const u=Object.keys(a),c=o.includes(n);if(r&&c&&o.length===1&&!s.length&&!u.length)return d=>{const h={...d};return delete h[n],h};const l=r&&!c&&!s.includes(n),p={preserveMissing:!0};return d=>{const h={};if(o.length&&!s.length){pt(h,d);for(const v of o)qt(h,v,{descendArray:!0})}for(const v of s){const y=he(d,v,p)??{};pt(h,y)}s.length&&yt(h);for(const v of u){const y=a[v](d);y===void 0?qt(h,v,{descendArray:!0}):Gi(h,v,y)}return l&&ue(d,n)&&(h[n]=Z(d,n)),h}}function jr(e,t){let r=!1,n=!1;for(const[i,o]of Object.entries(e))x(!i.startsWith("$"),"Field names may not start with '$'."),x(!i.endsWith(".$"),"Positional projection operator '$' is not supported."),i!==t?.idKey&&(o===0||o===!1?r=!0:(o===1||o===!0)&&(n=!0),x(!(r&&n),"Projection cannot have a mix of inclusion and exclusion."))}const no=(e,t,r)=>e.drop(t),Wr=(e,t,r)=>{if(Pt(t)||!$(t))return e;let n=j;const i=r.collation;return $(i)&&B(i.locale)&&(n=oo(i)),e.transform(o=>{const s=Object.keys(t);for(const a of s.reverse()){const u=zi(o,l=>Z(l,a),r.hashFunction),c=Array.from(u.keys()).sort(n);t[a]===-1&&c.reverse();let f=0;for(const l of c)for(const p of u.get(l))o[f++]=p;x(f==o.length,"bug: counter must match collection size.")}return o})},io={1:"base",2:"accent",3:"variant"};function oo(e){const t={sensitivity:io[e.strength||3],caseFirst:e.caseFirst==="off"?"false":e.caseFirst||"false",numeric:e.numericOrdering||!1,ignorePunctuation:e.alternate==="shifted"};(e.caseLevel||!1)===!0&&(t.sensitivity==="base"&&(t.sensitivity="case"),t.sensitivity==="accent"&&(t.sensitivity="variant"));const r=new Intl.Collator(e.locale,t);return(n,i)=>{if(!B(n)||!B(i))return j(n,i);const o=r.compare(n,i);return o<0?-1:o>0?1:0}}const so={$sort:Wr,$skip:no,$limit:ro};class ao{#e;#r;#t;#i;#s={};#n=null;#o=[];constructor(t,r,n,i){this.#e=t,this.#r=r,this.#t=n,this.#i=i}fetch(){if(this.#n)return this.#n;this.#n=Se(this.#e).filter(this.#r);const t=this.#i.processingMode;t&mt.CLONE_INPUT&&this.#n.map(we);for(const r of["$sort","$skip","$limit"])ue(this.#s,r)&&(this.#n=so[r](this.#n,this.#s[r],this.#i));return Object.keys(this.#t).length&&(this.#n=Kr(this.#n,this.#t,this.#i)),t&mt.CLONE_OUTPUT&&this.#n.map(we),this.#n}fetchAll(){const t=Se([...this.#o]);return this.#o=[],Ji(t,this.fetch())}all(){return this.fetchAll().value()}count(){return this.all().length}skip(t){return this.#s.$skip=t,this}limit(t){return this.#s.$limit=t,this}sort(t){return this.#s.$sort=t,this}collation(t){return this.#i={...this.#i,collation:t},this}next(){if(this.#o.length>0)return this.#o.pop();const t=this.fetch().next();if(!t.done)return t.value}hasNext(){if(this.#o.length>0)return!0;const t=this.fetch().next();return t.done?!1:(this.#o.push(t.value),!0)}map(t){return this.all().map(t)}forEach(t){this.all().forEach(t)}[Symbol.iterator](){return this.fetchAll()}}const uo=new Set(Array.from(["$and","$or","$nor","$expr","$jsonSchema"]));class Ie{#e;#r;#t;constructor(t,r){this.#t=we(t),this.#r=Qi(r),this.#e=[],this.compile()}compile(){x($(this.#t),`query criteria must be an object: ${JSON.stringify(this.#t)}`);const t={};for(const[r,n]of Object.entries(this.#t)){if(r==="$where")x(this.#r.scriptEnabled,"$where operator requires 'scriptEnabled' option to be true."),Object.assign(t,{field:r,expr:n});else if(uo.has(r))this.processOperator(r,r,n);else{x(!re(r),`unknown top level operator: ${r}`);for(const[i,o]of Object.entries(Br(n)))this.processOperator(r,i,o)}t.field&&this.processOperator(t.field,t.field,t.expr)}}processOperator(t,r,n){const i=Ee("query",r,this.#r);x(!!i,`unknown query operator ${r}`),this.#e.push(i(t,n,this.#r))}test(t){return this.#e.every(r=>r(t))}find(t,r){return new ao(t,n=>this.test(n),r||{},this.#r)}remove(t){return t.reduce((r,n)=>(this.test(n)||r.push(n),r),[])}}const co=["monday","mon","tuesday","tue","wednesday","wed","thursday","thu","friday","fri","saturday","sat","sunday","sun"];new Set(co);function T(e){return(r,n,i)=>{const o={unwrapArray:!0},s=Math.max(1,r.split(".").length-1);return a=>{const u=Z(a,r,o);return e(u,n,{...i,depth:s})}}}function qr(e,t,r){return U(e,t)||C(e)&&C(t)?!0:g(e)?e.some(n=>U(n,t))||Lr(e,r?.depth).some(n=>U(n,t)):!1}function fo(e,t,r){return!qr(e,t,r)}function zr(e,t,r){return C(e)?t.some(n=>n===null):ji([Oe(e),t],r?.hashFunction).length>0}function lo(e,t,r){return!zr(e,t,r)}function ho(e,t,r){return je(e,t,(n,i)=>j(n,i)<0)}function po(e,t,r){return je(e,t,(n,i)=>j(n,i)<=0)}function vo(e,t,r){return je(e,t,(n,i)=>j(n,i)>0)}function yo(e,t,r){return je(e,t,(n,i)=>j(n,i)>=0)}function mo(e,t,r){return Oe(e).some(n=>t.length===2&&n%t[0]===t[1])}function go(e,t,r){const n=Oe(e),i=o=>B(o)&&Ki(t.exec(o),r?.useStrictMode);return n.some(i)||Lr(n,1).some(i)}function bo(e,t,r){return Array.isArray(e)&&e.length===t}function wo(e){return re(e)&&["$and","$or","$nor"].indexOf(e)===-1}function Eo(e,t,r){if(g(e)&&!Pt(e)){let n=s=>s,i=t;Object.keys(t).every(wo)&&(i={temp:t},n=s=>({temp:s}));const o=new Ie(i,r);for(let s=0,a=e.length;s<a;s++)if(o.test(n(e[s])))return!0}return!1}const Gt=e=>e===null,So={array:g,boolean:oe,bool:oe,date:be,number:M,int:M,long:M,double:M,decimal:M,null:Gt,object:$,regexp:Q,regex:Q,string:B,undefined:C,function:e=>{throw new Ke("unsupported type key `function`.")},1:M,2:B,3:$,4:g,6:C,8:oe,9:be,10:Gt,11:Q,16:M,18:M,19:M};function Vt(e,t,r){const n=So[t];return n?n(e):!1}function _o(e,t,r){return g(t)?t.findIndex(n=>Vt(e,n))>=0:Vt(e,t)}function je(e,t,r){return Oe(e).some(n=>ge(n)===ge(t)&&r(n,t))}const Qt=(e,t)=>{const r={};return e.split("").forEach((n,i)=>r[n]=t*(i+1)),r};({...Qt("ABCDEFGHIKLM",1),...Qt("NOPQRSTUVWXY",-1)});const Xt={undefined:null,null:null,NaN:NaN,Infinity:new Error,"-Infinity":new Error};function N(e,t=Xt){const r=Object.assign({},Xt,t),n=new Set(Object.keys(r));return(i,o,s)=>{const a=ne(i,o,null,s);if(n.has(`${a}`)){const u=r[`${a}`];if(u instanceof Error)throw new Ke(`cannot apply $${e.name} to -inf, value must in (-inf,inf)`);return u}return e(a)}}N(Math.acos,{Infinity:1/0,0:new Error});N(Math.acosh,{Infinity:1/0,0:new Error});N(Math.asin);N(Math.asinh,{Infinity:1/0,"-Infinity":-1/0});N(Math.atan);N(Math.atanh,{1:1/0,"-1":-1/0});N(Math.cos);N(Math.cosh,{"-Infinity":1/0,Infinity:1/0});const Oo=Math.PI/180;N(e=>e*Oo,{Infinity:1/0,"-Infinity":1/0});const Io=180/Math.PI;N(e=>e*Io,{Infinity:1/0,"-Infinity":-1/0});N(Math.sin);N(Math.sinh,{"-Infinity":-1/0,Infinity:1/0});N(Math.tan);const xo=(e,t,r)=>{x(g(t),"Invalid expression: $and expects value to be an Array.");const n=t.map(i=>new Ie(i,r));return i=>n.every(o=>o.test(i))},Hr=(e,t,r)=>{x(g(t),"Invalid expression. $or expects value to be an Array");const n=t.map(i=>new Ie(i,r));return i=>n.some(o=>o.test(i))},$o=(e,t,r)=>{x(g(t),"Invalid expression. $nor expects value to be an array.");const n=Hr("$or",t,r);return i=>!n(i)},Po=(e,t,r)=>{const n={};n[e]=Br(t);const i=new Ie(n,r);return o=>!i.test(o)},Ro=T(qr),ko=T(vo),Ao=T(yo),Mo=T(zr),Co=T(ho),To=T(po),No=T(fo),Lo=T(lo),Do=T(mo),Bo=T(go),Fo=T(Eo),Ko=T(bo),Uo=(e,t,r)=>{const n=e.includes("."),i=!!t;return!n||e.match(/\.\d+$/)?o=>Z(o,e)!==void 0===i:o=>{const s=he(o,e,{preserveIndex:!0}),a=Z(s,e.substring(0,e.lastIndexOf(".")));return g(a)?a.some(u=>u!==void 0)===i:a!==void 0===i}},jo=T(_o);var Yt=!1;function Wo(e){return Yt||(zt("pipeline",{$sort:Wr,$project:Kr}),zt("query",{$and:xo,$eq:Ro,$elemMatch:Fo,$exists:Uo,$gt:ko,$gte:Ao,$in:Mo,$lt:Co,$lte:To,$ne:No,$nin:Lo,$mod:Do,$nor:$o,$not:Po,$or:Hr,$regex:Bo,$size:Ko,$type:jo}),Yt=!0),new Ie(e)}function qo(e,t){var r=W(e.primaryKey);t=ve(t);var n=_n(t);if(typeof n.skip!="number"&&(n.skip=0),n.selector?(n.selector=n.selector,Object.entries(n.selector).forEach(([l,p])=>{(typeof p!="object"||p===null)&&(n.selector[l]={$eq:p})})):n.selector={},n.index){var i=bn(n.index);i.includes(r)||i.push(r),n.index=i}if(n.sort){var f=n.sort.find(l=>Sn(l)===r);f||(n.sort=n.sort.slice(0),n.sort.push({[r]:"asc"}))}else if(n.index)n.sort=n.index.map(l=>({[l]:"asc"}));else{if(e.indexes){var o=new Set;Object.entries(n.selector).forEach(([l,p])=>{var d=!1;typeof p=="object"&&p!==null?d=!!Object.keys(p).find(h=>xt.has(h)):d=!0,d&&o.add(l)});var s=-1,a;e.indexes.forEach(l=>{var p=tt(l)?l:[l],d=p.findIndex(h=>!o.has(h));d>0&&d>s&&(s=d,a=p)}),a&&(n.sort=a.map(l=>({[l]:"asc"})))}if(!n.sort)if(e.indexes&&e.indexes.length>0){var u=e.indexes[0],c=tt(u)?u:[u];n.sort=c.map(l=>({[l]:"asc"}))}else n.sort=[{[r]:"asc"}]}return n}function ka(e,t){if(!t.sort)throw k("SNH",{query:t});var r=[];t.sort.forEach(i=>{var o=Object.keys(i)[0],s=Object.values(i)[0];r.push({key:o,direction:s,getValueFn:En(o)})});var n=(i,o)=>{for(var s=0;s<r.length;++s){var a=r[s],u=a.getValueFn(i),c=a.getValueFn(o);if(u!==c){var f=a.direction==="asc"?j(u,c):j(c,u);return f}}};return n}function Aa(e,t){if(!t.sort)throw k("SNH",{query:t});var r=Wo(t.selector),n=i=>r.test(i);return n}async function Ma(e,t){var r=await e.exec();if(!r)return null;if(Array.isArray(r))return Promise.all(r.map(i=>t(i)));if(r instanceof Map)return Promise.all([...r.values()].map(i=>t(i)));var n=await t(r);return n}function zo(e,t){if(!t.sort)throw k("SNH",{query:t});var r=Mi(e,t);return{query:t,queryPlan:r}}var Ca="_rxdb_internal";async function Ho(e,t){var r=await e.findDocumentsById([t],!1),n=r[0];if(n)return n}async function Ta(e,t,r){var n=await e.bulkWrite([t],r);if(n.error.length>0){var i=n.error[0];throw i}else{var o=W(e.schema.primaryKey),s=bt(o,[t],n),a=s[0];return a}}function Na(e,t){var r=Ho(e,t),n=e.changeStream().pipe(ht(i=>i.events.find(o=>o.documentId===t)),Ut(i=>!!i),ht(i=>Promise.resolve(se(i).documentData)),ki(r),Ai(i=>i),Ut(i=>!!i));return n}function La(e){return Object.assign({},...e.filter(t=>!!t))}function Da(e,t,r,n){if(n)throw n.status===409?k("CONFLICT",{collection:e.name,id:t,writeError:n,data:r}):n.status===422?k("VD2",{collection:e.name,id:t,writeError:n,data:r}):n}function Ba(e,t,r,n,i,o,s){for(var a=!!e.schema.attachments,u=[],c=[],f=[],l=Bn(10),p={id:l,events:[],checkpoint:null,context:i},d=p.events,h=[],v=[],y=[],O=r.size>0,m,w=n.length,P=function(){var b=n[E],S=b.document,_=b.previous,R=S[t],q=S._deleted,qe=_&&_._deleted,fe=void 0;O&&(fe=r.get(R));var z;if(fe){var ln=fe._rev;if(!_||_&&ln!==_._rev){var dn={isError:!0,status:409,documentId:R,writeRow:b,documentInDb:fe};return f.push(dn),1}var $e=a?Ze(b):b;a&&(q?_&&Object.keys(_._attachments).forEach(A=>{v.push({documentId:R,attachmentId:A,digest:se(_)._attachments[A].digest})}):(Object.entries(S._attachments).find(([A,L])=>{var ke=_?_._attachments[A]:void 0;return!ke&&!L.data&&(z={documentId:R,documentInDb:fe,isError:!0,status:510,writeRow:b,attachmentId:A}),!0}),z||Object.entries(S._attachments).forEach(([A,L])=>{var ke=_?_._attachments[A]:void 0;if(!ke)h.push({documentId:R,attachmentId:A,attachmentData:L,digest:L.digest});else{var pn=$e.document._attachments[A].digest;L.data&&ke.digest!==pn&&y.push({documentId:R,attachmentId:A,attachmentData:L,digest:L.digest})}}))),z?f.push(z):(a?c.push(Ze($e)):c.push($e),m=$e);var Pe=null,ze=null,Re=null;if(qe&&!q)Re="INSERT",Pe=a?G(S):S;else if(_&&!qe&&!q)Re="UPDATE",Pe=a?G(S):S,ze=_;else if(q)Re="DELETE",Pe=se(S),ze=_;else throw k("SNH",{args:{writeRow:b}});var hn={documentId:R,documentData:Pe,previousDocumentData:ze,operation:Re};d.push(hn)}else{var cn=!!q;if(a&&Object.entries(S._attachments).forEach(([A,L])=>{L.data?h.push({documentId:R,attachmentId:A,attachmentData:L,digest:L.digest}):(z={documentId:R,isError:!0,status:510,writeRow:b,attachmentId:A},f.push(z))}),z||(a?u.push(Ze(b)):u.push(b),m=b),!cn){var fn={documentId:R,operation:"INSERT",documentData:a?G(S):S,previousDocumentData:a&&_?G(_):_};d.push(fn)}}},E=0;E<w;E++)P();return{bulkInsertDocs:u,bulkUpdateDocs:c,newestRow:m,errors:f,eventBulk:p,attachmentsAdd:h,attachmentsRemove:v,attachmentsUpdate:y}}function Ze(e){return{previous:e.previous,document:G(e.document)}}function Go(e){return atob(e).length}function Vo(e){var t=e.data;if(!t)return e;var r={length:Go(t),digest:e.digest,type:e.type};return r}function G(e){if(!e._attachments||Object.keys(e._attachments).length===0)return e;var t=ve(e);return t._attachments={},Object.entries(e._attachments).forEach(([r,n])=>{t._attachments[r]=Vo(n)}),t}function Qo(e){return Object.assign({},e,{_meta:ve(e._meta)})}function Fa(e,t,r){Et.deepFreezeWhenDevMode(r);var n=W(t.schema.primaryKey),i={originalStorageInstance:t,schema:t.schema,internals:t.internals,collectionName:t.collectionName,databaseName:t.databaseName,options:t.options,async bulkWrite(o,s){for(var a=e.token,u=new Array(o.length),c=Wn(),f=0;f<o.length;f++){var l=o[f],p=Qo(l.document);p._meta.lwt=c;var d=l.previous;p._rev=Ct(a,d),u[f]={document:p,previous:d}}zn("preStorageWrite",{storageInstance:this.originalStorageInstance,rows:u});var h=await e.lockedRun(()=>t.bulkWrite(u,s)),v={error:[]};Gr.set(v,u);var y=h.error.length===0?[]:h.error.filter(b=>b.status===409&&!b.writeRow.previous&&!b.writeRow.document._deleted&&se(b.documentInDb)._deleted?!0:(v.error.push(b),!1));if(y.length>0){var O=new Set,m=y.map(b=>(O.add(b.documentId),{previous:b.documentInDb,document:Object.assign({},b.writeRow.document,{_rev:Ct(e.token,b.documentInDb)})})),w=await e.lockedRun(()=>t.bulkWrite(m,s));rt(v.error,w.error);var P=bt(n,u,v,O),E=bt(n,m,w);return rt(P,E),v}return v},query(o){return e.lockedRun(()=>t.query(o))},count(o){return e.lockedRun(()=>t.count(o))},findDocumentsById(o,s){return e.lockedRun(()=>t.findDocumentsById(o,s))},getAttachmentData(o,s,a){return e.lockedRun(()=>t.getAttachmentData(o,s,a))},getChangedDocumentsSince:t.getChangedDocumentsSince?(o,s)=>e.lockedRun(()=>t.getChangedDocumentsSince(se(o),s)):void 0,cleanup(o){return e.lockedRun(()=>t.cleanup(o))},remove(){return e.storageInstances.delete(i),e.lockedRun(()=>t.remove())},close(){return e.storageInstances.delete(i),e.lockedRun(()=>t.close())},changeStream(){return t.changeStream()}};return e.storageInstances.add(i),i}function Ka(e){if(e.schema.keyCompression)throw k("UT5",{args:{params:e}});if(Xo(e.schema))throw k("UT6",{args:{params:e}});if(e.schema.attachments&&e.schema.attachments.compression)throw k("UT7",{args:{params:e}})}function Xo(e){return!!(e.encrypted&&e.encrypted.length>0||e.attachments&&e.attachments.encrypted)}function Yo(e,t,r){var n=W(e.schema.primaryKey),i=r?r.lwt:wt,o=r?r.id:"";return qo(e.schema,{selector:{$or:[{"_meta.lwt":{$gt:i}},{"_meta.lwt":{$eq:i},[n]:{$gt:r?o:""}}],"_meta.lwt":{$gte:i}},sort:[{"_meta.lwt":"asc"},{[n]:"asc"}],skip:0,limit:t})}async function Ua(e,t,r){if(e.getChangedDocumentsSince)return e.getChangedDocumentsSince(t,r);var n=W(e.schema.primaryKey),i=zo(e.schema,Yo(e,t,r)),o=await e.query(i),s=o.documents,a=gn(s);return{documents:s,checkpoint:a?{id:a[n],lwt:a._meta.lwt}:r||{id:"",lwt:0}}}var Gr=new WeakMap,Jo=new WeakMap;function bt(e,t,r,n){return jn(Jo,r,()=>{var i=[],o=Gr.get(r);if(o||(o=t),r.error.length>0||n){for(var s=n||new Set,a=0;a<r.error.length;a++){var u=r.error[a];s.add(u.documentId)}for(var c=0;c<o.length;c++){var f=o[c].document;s.has(f[e])||i.push(G(f))}}else{i.length=t.length-r.error.length;for(var l=0;l<o.length;l++){var p=o[l].document;i[l]=G(p)}}return i})}class Vr{ttl;map=new Map;_to=!1;constructor(t){this.ttl=t}has(t){return this.map.has(t)}add(t){this.map.set(t,Qr()),this._to||(this._to=!0,setTimeout(()=>{this._to=!1,Zo(this)},0))}clear(){this.map.clear()}}function Zo(e){const t=Qr()-e.ttl,r=e.map[Symbol.iterator]();for(;;){const n=r.next().value;if(!n)return;const i=n[0];if(n[1]<t)e.map.delete(i);else return}}function Qr(){return Date.now()}function es(e){return e&&typeof e.then=="function"}Promise.resolve(!1);var ja=Promise.resolve(!0),Y=Promise.resolve();function Xr(e,t){return e||(e=0),new Promise(function(r){return setTimeout(function(){return r(t)},e)})}function ts(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function Rt(){return Math.random().toString(36).substring(2)}var et=0;function xe(){var e=Date.now()*1e3;return e<=et&&(e=et+1),et=e,e}function Wa(){return typeof navigator<"u"&&typeof navigator.locks<"u"&&typeof navigator.locks.request=="function"}var rs=xe,ns="native";function is(e){var t={time:xe(),messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(r){t.messagesCallback&&t.messagesCallback(r.data)},t}function os(e){e.bc.close(),e.subFns=[]}function ss(e,t){try{return e.bc.postMessage(t,!1),Y}catch(r){return Promise.reject(r)}}function as(e,t){e.messagesCallback=t}function us(){if(typeof globalThis<"u"&&globalThis.Deno&&globalThis.Deno.args)return!0;if((typeof window<"u"||typeof self<"u")&&typeof BroadcastChannel=="function"){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}else return!1}function cs(){return 150}var fs={create:is,close:os,onMessage:as,postMessage:ss,canBeUsed:us,type:ns,averageResponseTime:cs,microSeconds:rs};function kt(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return typeof t.webWorkerSupport>"u"&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=1e3*45),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&typeof e.idb.onclose=="function"&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=1e3*60),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=1e3*60*2),t.node.maxParallelWrites||(t.node.maxParallelWrites=2048),typeof t.node.useFastPath>"u"&&(t.node.useFastPath=!0),t}var ls=xe,ds="pubkey.broadcast-channel-0-",F="messages",We={durability:"relaxed"},hs="idb";function Yr(){if(typeof indexedDB<"u")return indexedDB;if(typeof window<"u"){if(typeof window.mozIndexedDB<"u")return window.mozIndexedDB;if(typeof window.webkitIndexedDB<"u")return window.webkitIndexedDB;if(typeof window.msIndexedDB<"u")return window.msIndexedDB}return!1}function At(e){e.commit&&e.commit()}function ps(e){var t=Yr(),r=ds+e,n=t.open(r);return n.onupgradeneeded=function(i){var o=i.target.result;o.createObjectStore(F,{keyPath:"id",autoIncrement:!0})},new Promise(function(i,o){n.onerror=function(s){return o(s)},n.onsuccess=function(){i(n.result)}})}function vs(e,t,r){var n=Date.now(),i={uuid:t,time:n,data:r},o=e.transaction([F],"readwrite",We);return new Promise(function(s,a){o.oncomplete=function(){return s()},o.onerror=function(c){return a(c)};var u=o.objectStore(F);u.add(i),At(o)})}function ys(e,t){var r=e.transaction(F,"readonly",We),n=r.objectStore(F),i=[],o=IDBKeyRange.bound(t+1,1/0);if(n.getAll){var s=n.getAll(o);return new Promise(function(u,c){s.onerror=function(f){return c(f)},s.onsuccess=function(f){u(f.target.result)}})}function a(){try{return o=IDBKeyRange.bound(t+1,1/0),n.openCursor(o)}catch{return n.openCursor()}}return new Promise(function(u,c){var f=a();f.onerror=function(l){return c(l)},f.onsuccess=function(l){var p=l.target.result;p?p.value.id<t+1?p.continue(t+1):(i.push(p.value),p.continue()):(At(r),u(i))}})}function ms(e,t){if(e.closed)return Promise.resolve([]);var r=e.db.transaction(F,"readwrite",We),n=r.objectStore(F);return Promise.all(t.map(function(i){var o=n.delete(i);return new Promise(function(s){o.onsuccess=function(){return s()}})}))}function gs(e,t){var r=Date.now()-t,n=e.transaction(F,"readonly",We),i=n.objectStore(F),o=[];return new Promise(function(s){i.openCursor().onsuccess=function(a){var u=a.target.result;if(u){var c=u.value;c.time<r?(o.push(c),u.continue()):(At(n),s(o))}else s(o)}})}function bs(e){return gs(e.db,e.options.idb.ttl).then(function(t){return ms(e,t.map(function(r){return r.id}))})}function ws(e,t){return t=kt(t),ps(e).then(function(r){var n={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:Rt(),eMIs:new Vr(t.idb.ttl*2),writeBlockPromise:Y,messagesCallback:null,readQueuePromises:[],db:r};return r.onclose=function(){n.closed=!0,t.idb.onclose&&t.idb.onclose()},Jr(n),n})}function Jr(e){e.closed||Zr(e).then(function(){return Xr(e.options.idb.fallbackInterval)}).then(function(){return Jr(e)})}function Es(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}function Zr(e){return e.closed||!e.messagesCallback?Y:ys(e.db,e.lastCursorId).then(function(t){var r=t.filter(function(n){return!!n}).map(function(n){return n.id>e.lastCursorId&&(e.lastCursorId=n.id),n}).filter(function(n){return Es(n,e)}).sort(function(n,i){return n.time-i.time});return r.forEach(function(n){e.messagesCallback&&(e.eMIs.add(n.id),e.messagesCallback(n.data))}),Y})}function Ss(e){e.closed=!0,e.db.close()}function _s(e,t){return e.writeBlockPromise=e.writeBlockPromise.then(function(){return vs(e.db,e.uuid,t)}).then(function(){ts(0,10)===0&&bs(e)}),e.writeBlockPromise}function Os(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t,Zr(e)}function Is(){return!!Yr()}function xs(e){return e.idb.fallbackInterval*2}var $s={create:ws,close:Ss,onMessage:Os,postMessage:_s,canBeUsed:Is,type:hs,averageResponseTime:xs,microSeconds:ls},Ps=xe,Rs="pubkey.broadcastChannel-",ks="localstorage";function en(){var e;if(typeof window>"u")return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch{}return e}function tn(e){return Rs+e}function As(e,t){return new Promise(function(r){Xr().then(function(){var n=tn(e.channelName),i={token:Rt(),time:Date.now(),data:t,uuid:e.uuid},o=JSON.stringify(i);en().setItem(n,o);var s=document.createEvent("Event");s.initEvent("storage",!0,!0),s.key=n,s.newValue=o,window.dispatchEvent(s),r()})})}function Ms(e,t){var r=tn(e),n=function(o){o.key===r&&t(JSON.parse(o.newValue))};return window.addEventListener("storage",n),n}function Cs(e){window.removeEventListener("storage",e)}function Ts(e,t){if(t=kt(t),!rn())throw new Error("BroadcastChannel: localstorage cannot be used");var r=Rt(),n=new Vr(t.localstorage.removeTimeout),i={channelName:e,uuid:r,eMIs:n};return i.listener=Ms(e,function(o){i.messagesCallback&&o.uuid!==r&&(!o.token||n.has(o.token)||o.data.time&&o.data.time<i.messagesCallbackTime||(n.add(o.token),i.messagesCallback(o.data)))}),i}function Ns(e){Cs(e.listener)}function Ls(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t}function rn(){var e=en();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch{return!1}return!0}function Ds(){var e=120,t=navigator.userAgent.toLowerCase();return t.includes("safari")&&!t.includes("chrome")?e*2:e}var Bs={create:Ts,close:Ns,onMessage:Ls,postMessage:As,canBeUsed:rn,type:ks,averageResponseTime:Ds,microSeconds:Ps},nn=xe,Fs="simulate",Mt=new Set;function Ks(e){var t={time:nn(),name:e,messagesCallback:null};return Mt.add(t),t}function Us(e){Mt.delete(e)}var on=5;function js(e,t){return new Promise(function(r){return setTimeout(function(){var n=Array.from(Mt);n.forEach(function(i){i.name===e.name&&i!==e&&i.messagesCallback&&i.time<t.time&&i.messagesCallback(t)}),r()},on)})}function Ws(e,t){e.messagesCallback=t}function qs(){return!0}function zs(){return on}var Hs={create:Ks,close:Us,onMessage:Ws,postMessage:js,canBeUsed:qs,type:Fs,averageResponseTime:zs,microSeconds:nn},Jt=[fs,$s,Bs];function Gs(e){var t=[].concat(e.methods,Jt).filter(Boolean);if(e.type){if(e.type==="simulate")return Hs;var r=t.find(function(i){return i.type===e.type});if(r)return r;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||(t=t.filter(function(i){return i.type!=="idb"}));var n=t.find(function(i){return i.canBeUsed()});if(n)return n;throw new Error("No usable method found in "+JSON.stringify(Jt.map(function(i){return i.type})))}var sn=new Set,Vs=0,an=function(t,r){this.id=Vs++,sn.add(this),this.name=t,this.options=kt(r),this.method=Gs(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,Qs(this)};an._pubkey=!0;an.prototype={postMessage:function(t){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(t));return Zt(this,"message",t)},postInternal:function(t){return Zt(this,"internal",t)},set onmessage(e){var t=this.method.microSeconds(),r={time:t,fn:e};tr(this,"message",this._onML),e&&typeof e=="function"?(this._onML=r,er(this,"message",r)):this._onML=null},addEventListener:function(t,r){var n=this.method.microSeconds(),i={time:n,fn:r};er(this,t,i)},removeEventListener:function(t,r){var n=this._addEL[t].find(function(i){return i.fn===r});tr(this,t,n)},close:function(){var t=this;if(!this.closed){sn.delete(this),this.closed=!0;var r=this._prepP?this._prepP:Y;return this._onML=null,this._addEL.message=[],r.then(function(){return Promise.all(Array.from(t._uMP))}).then(function(){return Promise.all(t._befC.map(function(n){return n()}))}).then(function(){return t.method.close(t._state)})}},get type(){return this.method.type},get isClosed(){return this.closed}};function Zt(e,t,r){var n=e.method.microSeconds(),i={time:n,type:t,data:r},o=e._prepP?e._prepP:Y;return o.then(function(){var s=e.method.postMessage(e._state,i);return e._uMP.add(s),s.catch().then(function(){return e._uMP.delete(s)}),s})}function Qs(e){var t=e.method.create(e.name,e.options);es(t)?(e._prepP=t,t.then(function(r){e._state=r})):e._state=t}function un(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function er(e,t,r){e._addEL[t].push(r),Xs(e)}function tr(e,t,r){e._addEL[t]=e._addEL[t].filter(function(n){return n!==r}),Ys(e)}function Xs(e){if(!e._iL&&un(e)){var t=function(i){e._addEL[i.type].forEach(function(o){i.time>=o.time&&o.fn(i.data)})},r=e.method.microSeconds();e._prepP?e._prepP.then(function(){e._iL=!0,e.method.onMessage(e._state,t,r)}):(e._iL=!0,e.method.onMessage(e._state,t,r))}}function Ys(e){if(e._iL&&!un(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}export{gn as $,Na as A,La as B,Da as C,Ba as D,Ze as E,Go as F,Vo as G,G as H,Ca as I,Qo as J,Fa as K,Ka as L,Vn as M,Xo as N,Yo as O,Ua as P,bt as Q,$n as R,le as S,de as T,Mi as U,xt as V,Ci as W,Ti as X,Ni as Y,Li as Z,Di as _,Pn as a,ja as a$,bn as a0,Js as a1,tt as a2,He as a3,rt as a4,Zs as a5,wn as a6,Ct as a7,wt as a8,ta as a9,ea as aA,ya as aB,jn as aC,Wn as aD,se as aE,ma as aF,ga as aG,Xe as aH,qn as aI,ba as aJ,wa as aK,at as aL,zn as aM,Ea as aN,$r as aO,Pa as aP,te as aQ,xi as aR,Oi as aS,ft as aT,ct as aU,Ri as aV,an as aW,Rt as aX,Wa as aY,Y as aZ,Xr as a_,ra as aa,na as ab,ia as ac,An as ad,Mn as ae,ua as af,Cn as ag,ca as ah,fa as ai,Tn as aj,la as ak,Nn as al,Ln as am,da as an,ha as ao,Dn as ap,Bn as aq,pa as ar,Fn as as,cr as at,va as au,En as av,ve as aw,Sn as ax,nt as ay,_n as az,oa as b,Ut as b0,ht as b1,ki as b2,Ar as b3,nr as b4,rr as b5,$a as b6,D as b7,V as b8,J as b9,gr as ba,pr as bb,_e as bc,dt as bd,ce as be,Vr as bf,qo as c,ka as d,sr as e,Aa as f,St as g,Ma as h,sa as i,fr as j,Sa as k,W as l,_a as m,k as n,Et as o,zo as p,Hn as q,aa as r,Oa as s,Gn as t,Ia as u,Qn as v,Xn as w,xa as x,Ho as y,Ta as z};
