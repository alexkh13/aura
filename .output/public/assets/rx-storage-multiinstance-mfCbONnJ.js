import{aO as p,aP as N,aQ as i,aR as S,aS as B,aT as b,aU as m,aV as R,aW as w}from"./broadcast-channel-K9QvgciB.js";function y(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];var r=p(a),o=N(a,1/0);return i(function(t,n){S(o)(B(b([t],m(a)),r)).subscribe(n)})}function A(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];return y.apply(void 0,b([],m(a)))}var u=new Map;function E(a,e,r,o){var t=u.get(e);return t||(t={bc:new w(["RxDB:",a,r].join("|")),refs:new Set},u.set(e,t)),t.refs.add(o),t.bc}function f(a,e){var r=u.get(a);if(r&&(r.refs.delete(e),r.refs.size===0))return u.delete(a),r.bc.close()}function L(a,e,r,o){if(e.multiInstance){var t=E(a,e.databaseInstanceToken,r.databaseName,r),n=new R,l=s=>{s.storageName===a&&s.databaseName===e.databaseName&&s.collectionName===e.collectionName&&s.version===e.schema.version&&n.next(s.eventBulk)};t.addEventListener("message",l);var c=r.changeStream(),v=!1,d=c.subscribe(s=>{v||t.postMessage({storageName:a,databaseName:e.databaseName,collectionName:e.collectionName,version:e.schema.version,eventBulk:s})});r.changeStream=function(){return n.asObservable().pipe(A(c))};var g=r.close.bind(r);r.close=async function(){return v=!0,d.unsubscribe(),t.removeEventListener("message",l),await f(e.databaseInstanceToken,r),g()};var h=r.remove.bind(r);r.remove=async function(){return v=!0,d.unsubscribe(),t.removeEventListener("message",l),await f(e.databaseInstanceToken,r),h()}}}export{u as B,L as a,E as g,f as r};
